```markdown
# Verify Content with Bing and GPT-4

This script verifies the factual accuracy of a given content by performing a Bing search and using GPT-4 to answer a related question. It integrates both the Bing Search API and OpenAI's GPT-4 model to enhance the verification process.

## Features

- **Bing Search Integration**: Searches the web using the Bing Search API for relevant information.
- **GPT-4 Answering**: Uses the GPT-4 model to process the search results and answer a given question.
- **Command-Line Interface**: Allows users to easily input API keys and content through command-line arguments.

## Requirements

- Python 3.6+
- `httpx`: A library for making HTTP requests.
- `langchain_openai`: A package to interact with OpenAI models through Azure.

Install the required libraries with:

```bash
pip install httpx langchain-openai
```

## Configuration

Before running the script, ensure you have the following:

1. **OpenAI API Key**: Obtain your OpenAI API key from the Azure OpenAI Portal.
2. **Bing API Key**: Obtain your Bing API key from Microsoft Azure Cognitive Services.

### Azure OpenAI Configuration

- **Deployment Name**: `gpt-4o`
- **API Version**: `2024-08-01-preview`
- **API Endpoint**: `https://mywiki-ai.openai.azure.com/`
- **Model Name**: `gpt-4o`

## Usage

Run the script from the command line using the following syntax:

```bash
python verify_content.py --openai_api_key <your_openai_api_key> --bing_api_key <your_bing_api_key> --content "<content_to_verify>"
```

### Arguments:

- `--openai_api_key`: Your OpenAI API key.
- `--bing_api_key`: Your Bing API key.
- `--content`: The content you want to verify.

## Example

To verify the content `"What is the capital of France?"` using your API keys, run:

```bash
python verify_content.py --openai_api_key "your_openai_api_key" --bing_api_key "your_bing_api_key" --content "What is the capital of France?"
```

### Output:

The script will print:

1. The search results from Bing.
2. The answer generated by GPT-4 based on the search results.

```bash
Search Results:
 Title: Capital of France
 URL: https://example.com/capital-of-france
 Snippet: The capital of France is Paris.

Answer:
 The capital of France is Paris.
```

## How it Works

1. **Bing Search**: The script queries Bing with the content and retrieves up to 3 relevant search results.
2. **GPT-4 Model**: The search results are fed into GPT-4, which generates an answer to the content query.
3. **Output**: The script returns both the Bing search results and the answer generated by GPT-4.

## Code Overview

The script consists of the following functions:

### `configure_llm(openai_api_key)`

Configures the GPT-4 model with the provided OpenAI API key.

### `bing_search_tool(query, bing_api_key)`

Uses the Bing Search API to search for the query and retrieve up to 3 relevant search results.

### `ask_llm_with_bing_results(llm, search_results, question)`

Creates a prompt combining the search results and the question for GPT-4 to generate an answer.

### `verify_content_with_bing_and_llm(content, openai_api_key, bing_api_key)`

Verifies the content by utilizing Bing search results and GPT-4 to generate a factual answer.

### `parse_arguments()`

Parses the command-line arguments for the OpenAI API key, Bing API key, and the content to verify.

## Example Script

```python
import argparse
import httpx
from langchain_openai import AzureChatOpenAI

def configure_llm(openai_api_key):
    """Configure the GPT-4 model with the provided OpenAI API key."""
    return AzureChatOpenAI(
        azure_deployment="gpt-4o",
        api_version="2024-08-01-preview",
        api_key=openai_api_key,
        azure_endpoint="https://mywiki-ai.openai.azure.com/",
        model="gpt-4o"
    )

# Tool: Bing Search
def bing_search_tool(query, bing_api_key):
    url = "https://api.bing.microsoft.com/v7.0/search"
    headers = {"Ocp-Apim-Subscription-Key": bing_api_key}
    params = {"q": query, "count": 3, "mkt": "en-US", "freshness": "Week"}
    response = httpx.get(url, headers=headers, params=params)
    results = response.json()
    # Return relevant details (titles, URLs, snippets)
    if "webPages" in results:
        return "\n".join([f"Title: {item['name']}\nURL: {item['url']}\nSnippet: {item['snippet']}" for item in results["webPages"].get("value", [])])
    return "No results found."

def ask_llm_with_bing_results(llm, search_results, question):
    """Use LLM to answer the question using Bing search results."""
    # Create a prompt that includes the search results and the question
    prompt = f"Using the following search results, answer the question:\n\n{search_results}\n\nQuestion: {question}\n\nAnswer:"
    
    # Get the answer from GPT-4
    response = llm(prompt)
    # Extract the content from the response
    answer = response.content if hasattr(response, 'content') else response
    return answer
    
def verify_content_with_bing_and_llm(content, openai_api_key, bing_api_key):
    """
    Verify the factual accuracy of the content using Bing search and answer the question with GPT-4.
    """
    # Configure LLM
    llm = configure_llm(openai_api_key)

    # Step 1: Use Bing search for relevant information
    search_results = bing_search_tool(content, bing_api_key)

    # Step 2: Use LLM to answer the question using the search results
    answer = ask_llm_with_bing_results(llm, search_results, content)

    # Return the search results and the answer
    return {
        "search_results": search_results,
        "answer": answer
    }

def parse_arguments():
    """Parse command-line arguments for API keys and content."""
    parser = argparse.ArgumentParser(description="Verify content using Bing search and GPT-4.")
    parser.add_argument("--openai_api_key", required=True, help="Your OpenAI API key")
    parser.add_argument("--bing_api_key", required=True, help="Your Bing API key")
    parser.add_argument("--content", required=True, help="The content to verify")
    return parser.parse_args()

if __name__ == "__main__":
    # Parse arguments
    args = parse_arguments()
    
    # Call the main function with provided inputs
    result = verify_content_with_bing_and_llm(args.content, args.openai_api_key, args.bing_api_key)
    
    # Print results
    if result["search_results"]:
        print("\nSearch Results:\n", result["search_results"])
    if result["answer"]:
        print("\nAnswer:\n", result["answer"])
```

## Contributing

Feel free to fork the repository and submit pull requests for any improvements or bug fixes.
